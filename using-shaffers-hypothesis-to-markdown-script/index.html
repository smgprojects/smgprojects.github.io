<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>using shaffer's hypothesis to markdown script</title>
    <meta name="description" content="An open history notebook forked from Jason Heppler">
    <meta name="author" content="Shawn Graham"/>

    <!-- Get date last modified from git log. (Uses current time if file entry not found, e.g. projects/)  -->
    

    <!-- For posts, page.date is the date they are published under, which we use as their 'canonical' dc:date -->
    
      
      

    <!-- RDFa Metadata (in DublinCore) -->
    <meta property="dc:title" content="using shaffer's hypothesis to markdown script" />
    <meta property="dc:creator" content="Shawn Graham" />
    <meta property="dc:date" content="2017-06-23T16:18:00-04:00" />
    <meta property="dc:format" content="text/html" />
    <meta property="dc:language" content="en" />
    <meta property="dc:identifier" content="/using-shaffers-hypothesis-to-markdown-script/" />
    <meta property="dc:rights" content="CC BY-NC-SA 3.0" />
    <meta property="dc:source" content="Shawn Graham's Open Digital Humanities Notebook 2016-17" />
    <meta property="dc:subject" content="History" />
    <meta property="dc:type" content="website" />

    <!-- RDFa Metadata (in OpenGraph) -->
    <meta property="og:title" content="using shaffer's hypothesis to markdown script" />
    <meta property="og:author" content="/bio.html" />
    <meta property="og:site_name" content="Shawn Graham's Open Digital Humanities Notebook 2016-17" />
    <meta property="og:url" content="/using-shaffers-hypothesis-to-markdown-script/" />
    <meta property="og:type" content="website" />

    <!-- Google Scholar Metadata -->
    <meta name="citation_author" content="Shawn Graham"/>
    <meta name="citation_date" content="2017-06-23T16:18:00-04:00"/>
    <meta name="citation_title" content="using shaffer's hypothesis to markdown script"/>
    <meta name="citation_journal_title" content="Shawn Graham's Open Digital Humanities Notebook 2016-17"/>

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="">
    <meta name="twitter:creator" content="">
    <meta name="twitter:url" content="">
    <meta name="twitter:title" content="Shawn Graham's Open Digital Humanities Notebook 2016-17">
    <meta name="twitter:description" content="An open history notebook forked from Jason Heppler">

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:100,400,400italic,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif' rel='stylesheet' type='text/css'>
    <script src="https://use.typekit.net/wak0qrc.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css">
    <script type="text/javascript" src="/components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/components/jquery/dist/jquery.min.js"></script>

    <!-- Custom Styling -->
    <!-- <link rel="stylesheet" href="/css/lmullen.css"> -->
    <link rel="stylesheet" href="/css/main.css"> 
    <!-- <link rel="stylesheet" href="/css/search.css"> -->
    <!-- <link rel="stylesheet" href="/css/custom.css"> -->
    <link rel="stylesheet" href="/css/bigfoot-default.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">
    <link rel="canonical" href="http://smgprojects.github.io/using-shaffers-hypothesis-to-markdown-script/">

    <!-- Initialize Bigfoot.js -->
    <script type="text/javascript" src="/components/bigfoot/bigfoot.js"></script>
    <script type="text/javascript">
        $.bigfoot();
    </script>

    <!-- Todo lists (via Lincoln Mullen) -->
    <script type="text/javascript">
      /* <![CDATA[ */
      $(document).ready(function() {
        $("li:contains('[ ]')").html(function(_, html) {
          return html.replace('[ ]', '<span style="color:red;">☐</span>');
        });
        $("li:contains('[s]')").html(function(_, html) {
          return html.replace('[s]', '<span style="color:gold;">☐</span>');
        });
        $("li:contains('[x]')").html(function(_, html) {
          return html.replace('[x]', '<span style="color:green;">☑</span>');
        });
      });
      /* ]]> */
    </script>
    <script defer async src="//hypothes.is/embed.js"></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Shawn Graham's Open Digital Humanities Notebook 2016-17</a>

    <nav class="site-nav">
      <ul>
        <li><a href="/about/">About</a></li>
        <li><a href="/essays/">Essays</a></li>
        <li><a href="/feed.xml">RSS</a></li>
      </ul>
    </nav>

  </div>

</header>


    <div class="page-content">
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">

  <div class="well sidebar-nav">

<!--- <center><img src="/images/logo.png" class="img-responsive" alt="Shawn Graham's Notebook"/><br/>
  <a href="http://electricarchaeology.ca">Shawn Graham</a>
  </center>
--->
  <br/>

  <div id="search">
    <form action="http://duckduckgo.com/" method="get">
    <input type="hidden" name="sites" value="smgprojects.github.io" />
      <input type="text" id="search_input" name="q" placeholder="Search" autocomplete="off">
    </form>
  </div>

    <ul class="nav nav-list">
      <li class="nav-header">General</li>
      <li><a href="/tagged/">Notes by Tag</a></li>
      <li><a href="/archive/">All Notes by Date</a></li>
      <li><a href="/archive-alphabetical/">All Notes Alphabetically</a></li>
      <li><a href="/essays/">Essays and General Writing</a></li>
      <li><a href="/categories/">Categories</a></li>

      <li class="nav-header">Topics and Projects</li>
      <li><a href="/reading-notes/">Reading Notes</a></li>
      <li><a href="/archaeogaming/">Archaeogaming</a></li>
      <li><a href="/design-studio/">Design Studio in DH</a></li>
      <li><a href="/soundbashing-history/">Soundbashing History</a></li>
      <li class="nav-header">Meta</li>
      <li><a href="/project-news/">Notebook News</a></li>
      <li><a href="/about/">About Me</a></li>
      <li><a href="/notebook/">About This Notebook</a></li>
    </ul>
  </div>

</div> <!-- / span3 -->


        <div class="span9">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">using shaffer's hypothesis to markdown script</h1>
    <p class="post-meta">Jun 23, 2017</p>
  </header>

  <article class="post-content">
    <ul id="markdown-toc">
  <li><a href="#usage" id="markdown-toc-usage">usage</a></li>
  <li><a href="#script" id="markdown-toc-script">script:</a></li>
</ul>

<h2 id="usage">usage</h2>

<p>to use shaffer’s hypothesis script:</p>

<p>1 - has to run in python 3
2 - uncomment <code>d = json.loads(h.text)</code> and comment out the <code>d = ast.literal_eval(h.text)</code>
3 - i pasted the <code>pypothesis.py</code> into my <code>grabH.py</code> script
4 - had to run a virtualenv: <code>virtualenv -p python3 grabH</code>
5 - activate: <code>source env/bin/grabH</code>
6 - run the script: ‘python grabH.py’
7 - copy the result to the notebook posts folder.</p>

<h2 id="script">script:</h2>

<pre><code>

import requests
import json
import ast

# pypothesis.py script pasted here cause frustrated
class Annotation():

    def __init__(self, jsondata):
        self.jsondata = jsondata

        # title of annotated article
        self.title = self.jsondata['document']['title'][0].replace('\n', '').replace('\r', '')

        # uri of annotated article
        self.uri = self.jsondata['uri']

        # highlighted text in annotated article
        if 'selector' in self.jsondata['target'][0].keys():
            selector = self.jsondata['target'][0]['selector']
            for entry in selector:
                if 'exact' in entry.keys():
                    self.highlight = entry['exact'].replace('\n', ' ').replace('\r', ' ')
                else:
                    self.highlight = 'No highlighted text found.'
        else:
            self.highlight = 'No highlighted text found.'

        # annotation comment
        if self.jsondata['text']:
            self.comment = self.jsondata['text']
        else:
            self.comment = 'No comment found.'

        # user that generated the annotation
        self.user = self.jsondata['user'].split(':')[1].split('@')[0]

        # date/time created and updated
        self.created = self.jsondata['created']
        self.updated = self.jsondata['updated']

        # hypothesis ID &amp; annotation URL
        self.id = self.jsondata['id']
        self.hypothesisurl = 'https://hyp.is/' + self.jsondata['id']

def retrieve(apiurl):
    # takes the hypothes.is API URL for an annotation and returns JSON data
    h = requests.get(apiurl)
    d = json.loads(h.text)
    return d

def retrievelist(searchurl):
    # takes a hypothes.is API search URL returns JSON data for each element as a list of individual annotations
    h = requests.get(searchurl)
    d = json.loads(h.text)
    jsonlist = []
    for entry in d['rows']:
        jsonlist.append(entry)
    return jsonlist

def apiurl(hypurl):
    # takes the hyp.is URL provided in an annotation and returns the API URL (for use elsewhere in this module)
    hypid = hypurl.split('.is/')[1].split('/')[0]
    url = 'https://hypothes.is/api/annotations/' + hypid
    return url

def searchurl(user = '', tag = '', tags = []):
    """
    Returns a well-formed URL for querying the hypothes.is API.
    A hypothes.is username is optional.
    Use *either* tag or tags, not both. You can also use neither if a username is provided.
    Use tag for a single tag, and put the tag in quotes.
    Use tags for multiple tags, and enclose them in a list: ['tag1', 'tag2', 'tag3'].
    searchurl() only works if at least once term (user, tag, or tags) is provided.
    """

    source = 'https://hypothes.is/api/search?'
    conn = '&amp;'
    usercall = 'user='
    tagcall = 'tags='
    if tags == []:
        if user != '' and tag != '':
            return source + usercall + user + conn + tagcall + tag
        if user == '' and tag != '':
            return source + tagcall + tag
        if user != '' and tag == '':
            return source + usercall + user
        if user == '' and tag == '':
            print('No search parameters included.')
    if tags != []:
        if user != '':
            sourcestring = source + usercall + user
            for entry in tags:
                sourcestring += (conn + tagcall + entry)
            return sourcestring
        if user == '':
            sourcestring = source + tagcall + tags.pop(0)
            while tags != []:
                sourcestring += (conn + tagcall + tags.pop(0))
            return sourcestring
###

source = 'https://hypothes.is/api/search?'
conn = '&amp;'
usercall = 'user='
tagcall = 'tags='

# adjust these variables for different searches
# also be sure to adjust the page title in the YAML header section
user = 'shawn.graham@hypothes.is'
tags = ''
# search string for fetching annotations from a specific user using a specific tag:
#     searchstring = source + usercall + user + conn + tagcall + tags
# search string for fetching all annotations from a specific user:
searchstring = source + usercall + user
# search string for fetching all annotations from any user, but limited to a specific tag (a class hashtag, for example):
#     searchstring = source + tagcall + tags
filename = '2017-06-23-hypothesis-annotations.md'

# YAML header
headerinfo = '---\n'
headerinfo += 'layout: post\n'
headerinfo += 'title: "Hypothes.is annotations"\n'
headerinfo += 'date: 2017-06-23 13:37:00 -0500\n' # need to make this automatic
headerinfo += 'categories:\n'
headerinfo += '- Reading Notes'
headerinfo += '---\n\n'

# don't edit anything below this line unless you know what you're doing :)
def writeMarkdown(header, data, filename):
    f = open(filename, 'w')
    f.write(header)
    for line in data:
        f.write(str(line) + '\n')

def markdown(annotation):
    # title of post with link to original post
    textout = '['
    textout += annotation['document']['title'][0].replace('\n', '').replace('\r', '')
    textout += ']('
    textout += annotation['uri']
    textout += ')\n\n'

    # grab highlighted portion of post
    if 'selector' in annotation['target'][0].keys():
        selector = annotation['target'][0]['selector']
        for entry in selector:
            if 'exact' in entry.keys():
                targetInfo = entry['exact'].replace('\n', ' ').replace('\r', ' ')
            else:
                targetInfo = 'No highlighted text found.'
    else:
        targetInfo = 'No highlighted text found.'

    # highlighted portion of post as blockquote
    textout += '&gt; '
    textout += targetInfo
    textout += '\n\n'

    # annotation comment, with username and link to stream
    if annotation['text']:
        textout += annotation['text']
        textout += '\n'
    textout += '(Curated by ['
    useracct = annotation['user'].split(':')[1].split('@')[0]
    textout += useracct
    textout += ']('
    textout += 'https://hypothes.is/stream?=user:'
    textout += useracct
    textout += '))\n\n&lt;hr/&gt;\n'
    return textout

# run
h = requests.get(searchstring)
#retained in case needed for valid unicode in JSON
d = json.loads(h.text)
# d = ast.literal_eval(h.text)


dataToWrite = []
i = 0
for row in d['rows']:
    dataToWrite.append(markdown(d['rows'][i]))
    i += 1
writeMarkdown(headerinfo, dataToWrite, filename)
</code></pre>

  </article>

  <p class="text-info">
    <table class="table table-condensed" id="post-info">
      <tr class="info">
        <td><small><i class="glyphicon glyphicon-calendar"></i>&nbsp;Created: 23 Jun 2017</small></td>
        <td><small><i class="glyphicon glyphicon-calendar"></i>&nbsp;Modified: 23 Jun 2017</small></td>
        <td><small><i class="fa fa-github-square"></i>&nbsp;<a
              href="https://github.com/smgprojects/notebook/commits/master/source/_posts/2017-06-23-using-shaffers-hypothesis-to-markdown-script.md">History</a></small></td>
        <td><small><a href="javascript:window.print()"><i class="glyphicon glyphicon-print"></i>&nbsp;Print</a></small></td>
        <td><small><a href="/using-shaffers-hypothesis-to-markdown-script/"><i class="glyphicon glyphicon-link"></i>Permalink</a></small></td>
      </tr>
    </table>
    </p>

<div class="tag-area alert-primary">
  <ul id="post-categories">
    <li><i class="glyphicon glyphicon-tags"></i>&nbsp;Tags: </li>
  
  </ul>
</div>

</div>

        </div>
      </div>
    </div>
    </div>

    <footer class="site-footer">

  <div class="footer-wrapper">

    <h2 class="footer-heading">Shawn Graham's Open Digital Humanities Notebook 2016-17</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <figure class="image-left">
            <img class="avatar" src="/images/minionme.jpeg" height="120" width="120"/>
          </figure>
          <p class="text">I'm at Carleton University in Ottawa Canada.</p>

          <form method="get" action="http://duckduckgo.com/">
            <input type="search" name="q" maxlength="255" placeholder="Search">
            <input type="hidden" names="sites" value="smgprojects.github.io">
            <input type="hidden" name="k7" value="#faf8f8">
            <input type="hidden" name="kj" value="#b33">
            <input type="hidden" name="ky" value="#fafafa">
            <input type="hidden" name="kx" value="b">
            <input type="hidden" name="ko" value="-1">
            <input type="hidden" name="k1" value="-1">
            <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
          </form>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          <li>
            <i class="fa fa-globe"></i> <a href="http://electricarchaeology.ca">electricarchaeology.ca</a>
          </li>
          
          <li>
              <i class="fa fa-github-square"></i> <a href="https://github.com/shawngraham"><span class="username">shawngraham</span>
            </a>
          </li>
          

          
          <li>
              <i class="fa fa-twitter-square"></i> <a href="https://twitter.com/electricarchaeo"><span class="username">electricarchaeo</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        Shawn Graham<br/>
        <ul class="social-media-list">
          <li><i class="fa fa-university"></i> Department of History, 406 Paterson Hall, Carleton University, Ottawa Canada</li>
          <li><i class="fa fa-envelope"></i> <a href="mailto:shawn.graham@carleton.ca">shawn.graham@carleton.ca</a></li>
        </ul>
      </div>
    </div>

  </div>

</footer>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75211414-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>

</html>
